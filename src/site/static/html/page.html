<div id="subpage-{{::page.pageId}}" layout="{{::(isSingleColumn ? 'column' : 'row')}}">
	<!-- Primary column -->
	<div layout="column" flex>
		<!-- Hash anchor -->
		<a id="page-{{::page.pageId}}"></a>

		<div layout-gt-sm="row" layout-align-gt-sm="space-between end">
			<div arb-next-prev page-id="{{::page.pageId}}" whiteframe="::true"></div>
		</div>

		<!-- For user page, display what domains this user has access to -->
		<div class="page-list-span"
				ng-if="::(page.isUser() && page.domainMembershipIds.length > 0 && !isSimpleEmbed)">
			<span>Domains this user has access to:</span>
			<span ng-repeat="(index, domainId) in ::page.domainMembershipIds">
				<span class="comma" ng-if="index > 0">,</span>
				<arb-page-title page-id="{{::domainId}}" is-link="true" ng-if="::domainId"></arb-page-title>
				<span ng-if="::!domainId">General</span>
			</span>
		</div>

		<!-- Unlisted page -->
		<div class="page-list-span md-whiteframe-1dp md-accent md-hue-1"
				layout-padding
				layout="row"
				layout-align="start center"
				ng-if="page.domainIds.length <= 0 && !page.isUser() && !page.isGroup() && !isSimpleEmbed">
			<!-- Hasn't been submitted -->
			<div ng-if="page.domainSubmissionsCount() <= 0">
				This page is
				<arb-page-title page-id="14z" is-link="true" custom-page-title="unlisted."></arb-page-title>
				<md-button class="md-primary md-raised"
						ng-click="submitToDomain()"
						ng-if="page.permissions.edit.has">
					Submit to math domain
				</md-button>
			</div>
			<!-- Has been submitted -->
			<div ng-if="page.domainSubmissionsCount() > 0">
				<span ng-if="page.domainSubmissions['1lw'].approverId == ''">
					This page has been submitted to Math domain and is pending approval.
				</span>
				<md-button class='md-primary md-raised'
						ng-click="arb.pageService.approvePageToDomain(page.pageId, '1lw')"
						ng-if="page.domainSubmissions['1lw'].approverId == '' && arb.userService.user.trustMap['1lw'].permissions.edit.has">
					Approve
				</md-button>
				<span ng-if="page.domainSubmissions['1lw'].approverId != ''">
					<arb-user-name user-id="{{::page.domainSubmissions['1lw'].approverId}}"></arb-user-name>
					added this page to the math domain, but the page is now orphaned.
				</span>
			</div>
		</div>

		<!-- Voting container -->
		<arb-vote-bar class="md-whiteframe-1dp" page-id="{{::page.pageId}}" ng-if="::page.hasVote"></arb-vote-bar>

		<!-- Lenses -->
		<div class="md-whiteframe-1dp">
			<!-- Tab labels -->
			<div class="page-tabs"
					layout="row"
					layout-xs="column"
					ng-if="::page.lensIds.length > 1">
				<md-button ng-repeat="lensId in ::page.lensIds"
						ng-click="tabsClicked($event,lensId)"
						ng-class="{'active-tab': lensId == selectedLens.pageId}"
						aria-label="Switch tab">
					<arb-page-title page-id="{{::lensId}}"
							custom-page-title="{{::(lensId === page.pageId ? 'Main' : arb.stateService.pageMap[lensId].lensTitle())}}"></arb-page-title>
				</md-button>
			</div>

			<!-- For each lens -->
			<div ng-repeat="lensId in ::page.lensIds" ng-if="lensId === selectedLens.pageId">
				<!-- Lens body -->
				<div class="md-whiteframe-1dp">
					<div class="md-whiteframe-1dp">
						<div class="page-lens-body">
							<div ng-style="{'min-height': 500}"
									layout="column"
									layout-align="center center"
									ng-if="!isLoaded(lensId)">
								<md-progress-circular md-mode="indeterminate"></md-progress-circular>
							</div>
							<arb-lens class="reveal-after-render"
									page-id="{{::lensId}}"
									lens-parent-id="{{::page.pageId}}"
									is-simple-embed="::isSimpleEmbed"
									ng-if="isLoaded(lensId)"></arb-lens>
						</div>
					</div>

					<!-- Parents and tags -->
					<div layout="column"
							layout-gt-sm="row"
							layout-align="start center"
							layout-padding>
						<!-- Parents -->
						<div class="page-list-span"
								ng-if="page.parentIds.length > 0" flex>
							<span>Parents:</span>
							<span ng-repeat="(index, parentId) in page.parentIds">
								<span class="comma" ng-if="index > 0">,</span>
								<arb-page-title page-id="{{::parentId}}" is-link="true"></arb-page-title>
							</span>
						</div>

						<!-- Tags -->
						<div class="page-list-span"
				 				ng-if="page.taggedAsIds.length > 0 && !isSimpleEmbed">
				 			<span>Tagged as:</span>
				 			<span ng-repeat="(index, tagId) in page.taggedAsIds">
				 				<span class="comma" ng-if="::(index > 0)">,</span>
				 				<arb-page-title page-id="{{::tagId}}" is-link="true"></arb-page-title>
				 			</span>
				 		</div>
					</div>
				</div>

				<!-- Action bar -->
				<arb-lens-toolbar page-id="{{::lensId}}"></arb-lens-toolbar>
			</div>

		</div>

		<!-- Answers section -->
		<a id="answers"></a>
		<div class="discussion-container" ng-if="::!isSimpleEmbed && page.isQuestion()">
			<div class="user-page-panel md-whiteframe-1dp" layout="column">
				<md-toolbar class="md-hue-2">
					<div class="md-toolbar-tools">
						Answers ({{page.answers.length}})
						<div flex></div>
						<md-menu ng-if="::page.permissions.edit.has">
							<md-button ng-click="$mdOpenMenu($event)" class="md-icon-button" aria-label="Answer actions">
								<md-icon>more_vert</md-icon>
							</md-button>
							<md-menu-content>
								<!-- Delete answers -->
								<md-menu-item>
									<md-button ng-click="toggleDeleteAnswers()" aria-label="Toggle delete answers">
										Toggle delete answers
									</md-button>
								</md-menu-item>
							</md-menu-content>
						</md-menu>
					</div>
				</md-toolbar>
				<arb-answers page-id="{{::page.pageId}}" show-delete="showDeleteAnswer" layout-margin></arb-answers>
			</div>
		</div>

		<!-- Marks section -->
		<div class="discussion-container" ng-if="::!isSimpleEmbed">
			<arb-marks ng-repeat="lensId in ::page.lensIds"
					class="reveal-after-render"
					page-id="{{::lensId}}"
					ng-if="isLoaded(lensId) && lensId === selectedLens.pageId"></arb-marks>
		</div>

		<!-- Discussion section -->
		<div class="discussion-container" ng-if="::!isSimpleEmbed">
			<arb-page-discussion ng-repeat="lensId in ::page.lensIds"
					class="reveal-after-render"
					page-id="{{::lensId}}"
					ng-if="isLoaded(lensId) && lensId === selectedLens.pageId"></arb-page-discussion>
		</div>
	</div>
</div>
