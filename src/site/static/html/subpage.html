<div id="subpage-{{::page.pageId}}"
		layout="column"
		class="subpage-content full-width md-whiteframe-2dp"
		ng-class="{'selected-subpage': isSelected()}"
		ng-if="!isDeleted && (!page.isEditorComment || userService.showEditorComments)">
	<!-- Comment header -->
	<div class="comment-header" layout="row" layout-align="start center" ng-if="::isComment">
		<md-icon ng-if="::!parentSubpageId">comment</md-icon>
		<span class="separator" ng-if="::!parentSubpageId"></span>

		<!-- User name -->
		<arb-user-name user-id="{{::page.creatorId}}"></arb-user-name>

		<!-- Collapse button -->
		<div layout="column" flex>
			<md-button aria-label="Collapse comment" ng-click="collapseToggle()">
				<md-icon ng-if="!isCollapsed">expand_less</md-icon>
				<md-icon ng-if="isCollapsed">expand_more</md-icon>
			</md-button>
		</div>

		<!-- RHS icons -->
		<arb-confirm-button
				confirmed="deleteSubpage()"
				show-icon="true"
				disabled="editing"
				ng-if="(page.creatorId === userService.user.id || userService.user.isAdmin) && isComment"></arb-confirm-button>
		<md-button ng-href="{{::pageService.getEditPageUrl(page.pageId)}}"
				class="md-icon-button"
				aria-label="Edit comment"
				ng-disabled="editing"
				ng-click="editSubpage($event)"
				ng-if="::(page.creatorId === userService.user.id)">
			<md-icon>create</md-icon>
		</md-button>
		<md-button class="md-icon-button" ng-href="{{::myUrl}}">
			<md-icon>link</md-icon>
		</md-button>
	</div>

	<!-- Question header -->
	<div class="comment-header"
			layout="row"
			layout-align="start center"
			layout-padding
			ng-if="::isQuestion">
		<div>
			<md-icon>help</md-icon>
			<arb-page-title page-id="{{::page.pageId}}" is-link="true"></arb-page-title>
			<ng-pluralize count="::page.answerCount"
					when="{'0': '(No answers)', 'one': '(One answer)', 'other': '({} answers)'}" flex></ng-pluralize>
		</div>
	</div>

	<!-- Collapsable body -->
	<div layout="column" ng-if="!isCollapsed" layout-margin>
		<arb-markdown class="comment-text-container" page-id="{{::page.pageId}}" ng-if="!editing && !isQuestion"></arb-markdown>
		<!-- Edit this subpage -->
		<div arb-edit-page
				class="edit-comment-embed"
				is-embedded="true"
				page-id="{{::page.pageId}}"
				done-fn="editDone(result)"
				ng-if="editing"></div>

		<!-- Footer -->
		<div class="comment-footer" layout="row" layout-align="start start" ng-if="!editing">
			<arb-likes page-id="{{::page.pageId}}" is-button="true" is-stretched="true"></arb-likes>
			<arb-subscribe page-id="{{::page.pageId}}" show-subscriber-count="true" ng-if="::!parentSubpageId"></arb-subscribe>
			<md-button class="md-primary"
					aria-label="Reply to comment"
					ng-click="newReply()"
					ng-disabled="newReplyId"
					arb-user-check="cool"
					ng-if="::(!isQuestion && !parentSubpageId && page.subpageIds.length <= 0)">
				<md-icon>reply</md-icon>
				Reply
			</md-button>
			<span ng-if="::(isQuestion && page.commentIds.length > 0)">
				<md-icon>comment</md-icon>
				<span ng-bind="::page.commentIds.length"></span>
			</span>
			<span flex></span>
			<span class="md-caption" ng-bind="::(page.originalCreatedAt | relativeDateTime)"></span>
		</div>

		<!-- Indented reply section -->
		<div layout="row">
			<div flex="10"></div>
			<div flex="90" layout="column">
				<!-- Replies -->
				<div arb-subpage lens-id="{{::lensId}}"
						page-id="{{::subpageId}}"
						parent-subpage-id="{{::page.pageId}}"
						ng-repeat="subpageId in page.subpageIds"></div>

				<!-- Reply to thread button -->
				<md-button class="md-primary"
						aria-label="Reply to thread"
						ng-click="newReply()"
						arb-user-check="cool"
						ng-if="!newReplyId && page.subpageIds.length > 0">
					<md-icon>reply</md-icon>
					New Reply
				</md-button>

				<!-- Write a new reply -->
				<div arb-edit-page
						class="new-comment-edit-page edit-comment-embed"
						is-embedded="true"
						page-id="{{newReplyId}}"
						done-fn="newReplyDone(result)"
						ng-if="newReplyId"></div>
			</div>
		</div>
	</div>
</div>
