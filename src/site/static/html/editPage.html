<form class="edit-page-body new-page-form">
	<!-- Alerts -->
	<div class="edit-page-alerts">
		<div ng-switch="page.getEditLevel()" ng-show="page.wasPublished">
			<div ng-switch-when="admin" class="alert alert-warning">Enforcing admin priviledges.</div>
			<div ng-switch-when="comment" class="alert alert-danger" role="alert">Can't edit a comment you didn't create.</div>
			<div ng-switch-when="" hidden></div>
			<div ng-switch-default class="alert alert-danger" role="alert">You don't have enough karma to edit this page. Required: {[{page.getEditLevel()}]}.</div>
		</div>
		<!-- Lock info -->
		<div ng-show="lockExists">
			<div ng-show="page.lockedBy!='0' && page.lockedBy===userService.user.id" class="alert alert-info">
				You have locked the page. The lock will expire {[{page.lockedUntil | relativeDateTime}]}.
			</div>
			<div ng-show="lockedByAnother" class="alert alert-danger">
				<arb-user-name user-id="{[{page.lockedBy}]}"></arb-user-name>
				has the page locked. The lock will end {[{page.lockedUntil | relativeDateTime}]}.
			</div>
		</div>
		<!-- Show a warning if we are on a different branch from the current edit. -->
		<div ng-show="showDifferentBranchWarning">
			<div class="alert alert-warning">
				The edit you are working on doesn't descend from the currently published edit.
			</div>
		</div>
		<!-- Check permissions -->
		<div ng-hide="groupPermissionsPassed" class="alert alert-danger">
			You need to be part of {[{userService.groupMap[page.groupId].name}]} group to edit this page.
		</div>
		<!-- Friendly warnings / info alerts -->
		<div ng-show="page.wasPublished">
			<div ng-show="page.isAutosave" class="alert alert-warning">
				Restored autosave which was last updated {[{page.createdAt | relativeDateTime}]}.
				<a href="#" class="abandon-edit">Delete my autosave and edit live version.</a>
			</div>
			<div ng-show="page.isSnapshot" class="alert alert-warning">
				Restored snapshot which was last updated {[{page.createdAt | relativeDateTime}]}.
				<a ng-href="{[{page.editUrl}]}?edit=live">Switch to editing the live version.</a>
			</div>
		</div>
	</div>

	<!-- Edit history panel -->
	<div class="edit-history panel panel-default" ng-show="page.editHistoryMap">
		<div class="panel-heading">
			<a data-toggle="collapse" data-parent="#accordion" href="#editHistory">Edit History</a>
		</div>
		<div id="editHistory" class="panel-collapse collapse">
			<div class="panel-body edit-history-body">
			</div>
		</div>
	</div>

	<!-- Show similar pages -->
	<div class="similar-pages panel panel-default" ng-show="isQuestion">
		<div class="panel-heading">
			Similar questions
		</div>
		<div class="panel-body">
		</div>
	</div>

	<div ng-class="{'half': !useVerticalView}">
		<!-- Invisible meta data -->
		<input name="prevEdit"
			type="text"
			class="prev-edit"
			ng-value="page.isAutosave ? page.prevEdit : page.edit"
			hidden>
		
		<!-- Title -->
		<div class="page-title" ng-hide="isComment">
			<input name="title"
				type="text"
				class="form-control input-lg"
				ng-model="page.title"
				placeholder="{[{getTitlePlaceholder()}]}"
				ng-required="!isComment"
				autocomplete="off"
				ng-readonly="lockedByAnother">
		</div>

		<!-- Clickbait -->
		<div class="page-clickbait" ng-hide="isComment">
			<input name="clickbait"
				type="text"
				class="form-control input-lg"
				ng-model="page.clickbait"
				placeholder="Clickbait"
				autocomplete="off"
				ng-readonly="lockedByAnother">
		</div>

		<!-- WMD edit panel -->
		<div class="wmd-panel-container">
			<div class="wmd-panel">
				<div id="wmd-button-bar{[{page.pageId}]}"></div>
				<textarea name="text"
						class="edit-page-text wmd-input form-control"
						id="wmd-input{[{page.pageId}]}"
						rows="{[{isComment ? 10 : 30}]}"
						placeholder="Truth is singular. Its &#34;versions&#34; are mistruths.&#13;&#10;&mdash; Sonmi-451"
					  style="resize: none;"
					  ng-bind="page.text"
						ng-readonly="lockedByAnother"></textarea>
				<div class="wmd-panel-bottom-buttons">
					<img src="/static/images/loading.gif" class="loading-indicator" toggle-on-submit/>
					<button type="button" class="abandon-edit btn btn-danger" ng-hide="lockedByAnother" toggle-on-submit>Abandon</button>
					<button type="button" class="go-to-page-view btn btn-default" ng-bind="isModal ? 'Hide Popup' : 'Go To Page View'" toggle-on-submit></button>
					<span class="gray-text autosave-label" hidden></span>
					<span class="warning-glyph glyphicon glyphicon-warning-sign pull-right"
						title="The edit you are working on doesn't descend from the currently published edit."
						ng-show="showDifferentBranchWarning"></span>
					<button type="submit" class="btn btn-primary pull-right" ng-hide="lockedByAnother" ng-bind="getSubmitButtonText()" toggle-on-submit></button>
					<button type="button" class="save-snapshot-button btn btn-default pull-right" ng-hide="lockedByAnother" toggle-on-submit>Save Snapshot</button>
					<div class="alert alert-danger" hidden></div>
					<span class="loading-text" style="display:none"></span>
					<div class="clearfix"></div>
					<div class="submit-form-error alert alert-danger" hidden></div>
				</div>
			</div>
		</div>

		<!-- Page options -->
		<div class="new-page-options form-horizontal">

			<!-- Meta-text panel -->
			<div ng-hide="isComment">
				<textarea name="metaText"
						class="meta-text-input form-control"
						rows="20"
						placeholder="Meta data"
					  style="resize: none;"
					  ng-bind="page.metaText"
						ng-readonly="lockedByAnother"></textarea>
				<div class="meta-text-error alert alert-danger"></div>
			</div>

			<!-- Page type -->
			<div class="form-group" ng-show="!page.wasPublished && !isSecondary">
				<label class="title-label control-label col-sm-2">Page Type</label>
				<div class="col-sm-4">
					<select ng-model="page.type" required="string"
							name="type" class="type-select form-control"
							ng-options="type as label for (type,label) in pageTypes">
					</select>
				</div>
				<div class="type-help col-sm-6">
					<p class="type-help-wiki help-block" ng-show="page.type=='wiki'">Standard wiki page.</p>
					<p class="type-help-lens help-block" ng-show="page.type=='lens'">A lens page is used to present the same material as another page but with different emphasis / assumptions.</p>
				</div>
			</div>

			<!-- Minor edit -->
			<div class="form-group">
				<label class="title-label control-label col-sm-2">Minor Edit</label>
				<div class="col-sm-8">
					<div class="checkbox">
						<label>
							<input type="checkbox" name="isMinorEditStr" ng-checked="page.isMinorEdit">
						</label>
					</div>
				</div>
			</div>
		
			<!-- Group id -->
			<div class="form-group" ng-show="canChangeGroup">
				<label class="title-label control-label col-sm-2">Group <span class="dashed-underline" title="Only members of the selected group will be able to see this page.">(?)</span></label>
				<div class="col-sm-4">
					<select ng-model="page.groupId"
							name="groupId" class="group-select type-select form-control"
							ng-options="type as label for (type,label) in groupOptions">
					</select>
				</div>
			</div>
		
			<!-- Show/hide vote -->
			<div class="form-group" ng-show="page.lockedVoteType != '' && !isQuestion && !isComment">
				<label class="title-label control-label col-sm-2">Show Vote</label>
				<div class="col-sm-8">
					<div class="checkbox">
						<label>
							<input type="checkbox" name="hasVoteStr" ng-checked="page.hasVote">
						</label>
					</div>
				</div>
			</div>
		
			<!-- Vote type -->
			<div class="form-group" ng-show="page.lockedVoteType == '' && !isQuestion && !isComment">
				<label class="title-label control-label col-sm-2">Vote Type</label>
				<div class="col-sm-4">
					<select ng-model="page.voteType"
							name="voteType" class="type-select form-control"
							ng-options="type as label for (type,label) in voteTypes">
					</select>
				</div>
			</div>
		
			<!-- Karma edit lock -->
			<div class="karma-lock-form-group form-group"
					ng-show="userService.user.getMaxKarmaLock() > 0 && page.type != 'blog' && !isComment">
				<label class="title-label control-label col-sm-2">Karma Lock
					<span title="Editing this page will require a minimum amount of karma." class="dashed-underline">(?)</span>
				</label>
				<div class="col-sm-4">
					<div class="karma-lock-slider" ng-model="page.karmaLock" max="{[{userService.user.getMaxKarmaLock()}]}"></div>
				</div>
			</div>
		
			<!-- Parents -->
			<div class="form-group" ng-show="!isComment">
				<label class="control-label col-sm-2">Parents</label>
				<div class="col-sm-4">
					<div class="input-group">
						<input type="text" class="tag-input form-control" placeholder="Enter new parent">
						<button type="button"
							  class="btn btn-default btn-xs child-parent-option"
							  ng-show="isModal && !isQuestion && !isLens">
							Make this page a sibling.
						</button>
					</div>
				</div>
				<div class="col-sm-6 parent-container">
					<a href="#" class="tag template label label-default" data-toggle="tooltip" title=""></a>
				</div>
			</div>
		
			<!-- Alias -->
			<div class="form-group" ng-show="!isAnswer && !isComment">
				<label class="control-label col-sm-2">Alias</label>
				<div class="col-sm-4">
					<div class="input-group">
						<input type="text"
								name="alias"
								placeholder='Optional alias, e.g. "HumanHealth"'
								class="form-control"
								ng-model="page.alias">
					</div>
				</div>
			</div>
		
			<!-- Sort children option -->
			<div class="form-group" ng-show="!isSecondary">
				<label class="title-label control-label col-sm-2">Sort Children</label>
				<div class="col-sm-4">
					<select ng-model="page.sortChildrenBy"
							name="sortChildrenBy" class="sort-children-select form-control"
							ng-options="type as label for (type,label) in sortTypes">
					</select>
				</div>
			</div>
		</div>
	</div>

	<!-- Right half with the preview -->
	<div class="preview-half" ng-class="{'half': !useVerticalView}">
		<div ng-class="{'panel': useVerticalView, 'panel-default': useVerticalView}">
			<div class="page-title" ng-class="{'panel-heading': useVerticalView}">
				<span class="page-title-text" ng-bind="page.title"></span>
				<span class="gray-text" ng-show="useVerticalView">(Preview)<span>
			</div>
			<div ng-class="{'panel-body': useVerticalView}">
				<div id="wmd-preview{[{page.pageId}]}" class="wmd-preview pagedown"></div>
				<div class="wmd-preview pagedown"></div>
			</div>
		</div>
	</div>

	<!-- Right half with the diff -->
	<div class="diff-half half">
		<div class="page-title">
			<a href="#"
				title="Recompute the diff"
				class="refresh-diff btn btn-default glyphicon glyphicon-refresh pull-right"></a>
			<a href="#"
				title="Go back to the preview"
				class="hide-diff btn btn-default glyphicon glyphicon-list-alt pull-right"></a>
			<span class="edit-num-text gray-text"></span>
			<span class="page-title-text"></span>
		</div>
		<div class="edit-diff">
		</div>
	</div>
</form>
