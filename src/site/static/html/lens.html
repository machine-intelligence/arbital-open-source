<div layout="column">

	<!-- Requirements -->
	<div class="requirements-container"
			ng-if="!isSimpleEmbed && showRequirementsPanel">
		<div>
			<span class="md-subhead" ng-class="{'md-accent': !meetsAllRequirements()}">
				This lens relies on:
			</span>
			<span arb-mastery-list ids-source="::page.requirementIds" is-span="true"></span>

			<!-- Mark all as known -->
			<md-button class="md-icon-button small-button md-primary"
					ng-click="toggleRequirements()"
					aria-label="Toggle requirements"
					ng-if="::(page.requirementIds.length > 1)">
				<md-icon>done_all</md-icon>
				<md-tooltip md-delay="500">Toggle all</md-tooltip>
			</md-button>
		</div>

		<!-- Learn suggestion -->
		<div class="lens-suggestion" ng-show="!meetsAllRequirements()">
			<a ng-href="/learn/{{::page.alias}}">
				Learn the requisites
			</a>
		</div>
	</div>

	<!-- Page's text. Populated by markdown. -->
	<div class="lens-text-container">
		<arb-slow-down-button page-id="{{::page.pageId}}"></arb-slow-down-button>

		<!-- Page title -->
		<h1>
			<md-icon class="page-title-icon" ng-if="::isUser">person</md-icon>
			<md-icon class="page-title-icon" ng-if="::page.isQuestion()">help</md-icon>
			<span class="md-display-3"
					ng-class="::{'center-text': isTinyScreen, 'dynamic-hor-padding simple-embed-page-title': isSimpleEmbed}"
					ng-bind="page.title"></span>
		</h1>

		<!-- Owner -->
		<div class="author-list md-caption page-list-span" ng-if="::(page.editGroupId !== '' && !isSimpleEmbed)">
			Owner:
			<arb-page-title page-id="{{::page.editGroupId}}"
					is-link="true"
					ng-if="::!arb.userService.userMap[page.editGroupId]"></arb-page-title>
			<arb-user-name user-id="{{::page.editGroupId}}"
					ng-if="::arb.userService.userMap[page.editGroupId]"></arb-user-name>
		</div>

		<!-- Body text -->
		<arb-markdown class="lens-text"
				page-id="{{::page.pageId}}"></arb-markdown>

		<!-- Contributors -->
		<div class="author-list md-caption page-list-span"
				ng-if="::(page.creatorIds.length > 0 && !isSimpleEmbed && page.seeGroupId &&
					!(page.editGroupId === page.creatorIds[0] && page.creatorIds.length == 1))">
			<br>
			<ng-pluralize count="::page.creatorIds.length"
					when="{'one': 'Contributor:', 'other': 'Contributors:'}"></ng-pluralize>
			<span ng-repeat="(index, creatorId) in ::page.creatorIds">
				<span class="comma" ng-if="::(index > 0)">,</span>
				<arb-user-name ng-class="::{bold: creatorId === page.pageCreatorId}"
						user-id="{{::creatorId}}"></arb-user-name>
			</span>
		</div>

		<div layout-gt-xs="row" layout-align="start end">
			<!-- Subjects taught -->
			<div flex ng-if="(!isSimpleEmbed && subjectIds.length > 0 && showLearnedPanel)">
				<span class="md-subhead">
					<md-icon>assignment</md-icon>
					Did you learn
					<span ng-bind="::(subjectIds.length > 1 ? 'these concepts' : 'this concept')"></span>
					from "<span ng-bind="::page.title"></span>"?
				</span>
				<div arb-mastery-list
						ids-source="::subjectIds"
						show-clickbait="::true"
						unlocked-fn="pagesUnlocked(result)"></div>

				<!-- Mark as done button -->
				<md-button class="special md-raised"
						ng-click="toggleSubjects(false)"
						aria-label="Toggle subjects"
						ng-if="!showQuickContinue()">
					<span ng-bind="getToggleSubjectsText()"></span>
				</md-button>
				<!-- Mark as done button AND continue -->
				<md-button class="special md-raised"
						ng-click="toggleSubjects(true)"
						aria-label="Toggle subjects"
						ng-bind="getQuickContinueText()"
						ng-if="showQuickContinue()">
					<md-icon>chevron_right</md-icon>
				</md-button>
			</div>

			<arb-next-prev page-id="{{::lensParentId}}"
					extra-info="!showQuickContinue()"></arb-next-prev>

			<arb-path-nav page-id="{{::pageId}}"></arb-path-nav>
		</div>

		<!-- You can now read... -->
		<div ng-if="unlockedIds && unlockedIds.length > 0">
			Now you have all the requirements for:
			<span ng-repeat="(index, unlockedId) in unlockedIds">
				<span class="comma" ng-if="index > 0">,</span>
				<arb-page-title page-id="{{::unlockedId}}" is-link="true"></arb-page-title>
			</span>
		</div>
	</div>

	<!-- Action bar -->
	<arb-lens-toolbar></arb-lens-toolbar>

	<!-- Inline comments container -->
	<div class="inline-comments-div" ng-show="::!isSimpleEmbed">
		<!-- Absolutely positioned RHS buttons -->
		<div class="rhs-buttons"
				ng-style="getRhsButtonsStyle()"
				layout="column"
				layout-gt-md="row"
				ng-show="showRhsButtons">

			<!-- FAB for editor feedback -->
			<md-fab-speed-dial class="md-scale editor-feedback-fab"
					md-direction="down"
					md-open="isEditorFeedbackFabOpen"
					ng-mouseenter="toggleEditorFeedbackFab(true)"
					ng-mouseleave="toggleEditorFeedbackFab(false)">
				<md-fab-trigger>
					<md-button ng-click="newInlineComment()"
							class="rhs-button md-fab md-mini md-primary md-hue-1"
							arb-user-check="cool"
							aria-label="Comment">
						<md-icon>comment</md-icon>
						<md-tooltip md-delay="500">Comment</md-tooltip>
					</md-button>
				</md-fab-trigger>
				<!-- TODO: uncomment the following once we decide to bring back query marks -->
<!-- 				<md-fab-trigger>
					<md-button class="rhs-button md-fab md-mini md-primary md-hue-1"
							arb-user-check="cool"
							aria-label="Menu">
						<md-icon>add</md-icon>
					</md-button>
				</md-fab-trigger>
				<md-fab-actions ng-class="{'md-whiteframe-4dp white-background': isEditorFeedbackFabOpen}">
					<md-button class="rhs-dropdown-button"
							ng-click="newEditorMark('typo')"
							aria-label="Spelling/grammar">
						<md-icon>rate_review</md-icon>
						Spelling/grammar
					</md-button>
					<md-button class="rhs-dropdown-button"
							ng-click="newQueryMark()"
							aria-label="Question/objection">
						<md-icon md-svg-icon="cursor_pointer"></md-icon>
						Question/objection
					</md-button>
					<md-button class="rhs-dropdown-button"
							ng-click="newInlineComment()"
							aria-label="Comment">
						<md-icon>comment</md-icon>
						Comment
					</md-button>
				</md-fab-actions> -->
			</md-fab-speed-dial>
		</div>

		<!-- All the inline comment icons -->
		<div class="inline-comment-icon"
				ng-style="getInlineCommentIconStyle(commentId)"
				ng-mouseenter="inlineCommentIconMouseover(commentId, true)"
				ng-mouseleave="inlineCommentIconMouseover(commentId, false)"
				ng-repeat="(commentId,comment) in inlineComments">
			<md-button class="md-icon-button md-raised"
					ng-class="{'md-primary': isInlineCommentIconSelected(commentId)}"
					ng-click="toggleInlineComment(commentId)"
					aria-label="Inline comment">
				<md-icon>comment</md-icon>
			</md-button>
		</div>

		<!-- All the mark icons -->
		<div class="inline-comment-icon"
				ng-style="getInlineMarkIconStyle(markId)"
				ng-mouseenter="inlineMarkIconMouseover(markId, true)"
				ng-mouseleave="inlineMarkIconMouseover(markId, false)"
				ng-repeat="(markId,markParams) in inlineMarks">
			<md-button class="md-icon-button md-raised"
					ng-class="{'md-primary': isInlineMarkIconSelected(markId)}"
					ng-click="toggleInlineMark(markId)"
					aria-label="Question/objection">
				<md-icon md-svg-icon="cursor_pointer"
						ng-class="{'resolved-mark': arb.markService.markMap[markId].resolvedBy!=''}"
						ng-if="::arb.markService.markMap[markId].type === 'query'"></md-icon>
				<md-icon ng-class="{'resolved-mark': arb.markService.markMap[markId].resolvedBy!=''}"
						ng-if="::arb.markService.markMap[markId].type !== 'query'">rate_review</md-icon>
			</md-button>
		</div>
	</div>
</div>
