{{/* editPage.tmpl is the page for creating a new page or editing an existing one. */}}
{{define "base"}}
<!DOCTYPE html>
<html>
<head>
	<title>{{if .Page.Title}}Edit - {{.Page.Title}}{{else}}New Page{{end}} - Zanaduu</title>
	{{template "style"}}
	{{template "scripts"}}
	{{template "angular" .}}
	<script>
		// Map of all aliases: fullName -> {pageId, title}
		var pageAliases = { {{range .Aliases}}"{{.FullName}}":{pageId:"{{.PageId}}", title:"{{.PageTitle}}"},{{end}} };
		// This array stores all available aliases for link autocompletion.
		var allAliases = [];
		for (var fullName in pageAliases) {
			var val = pageAliases[fullName];
			allAliases.push('"' + val.title + '" (' + fullName + ')');
		}
	</script>
	<script src="/static/js/editPage.js"></script>
	<script>
		// MainCtrl is the main control for this page.
		app.controller("MainCtrl", function ($scope, pageService, userService) {
			$scope.pageId = "{{.Page.PageId}}";
			$scope.page = pageService.pageMap[$scope.pageId];
		});
	</script>
</head>

<body privacy-key="{{.Page.PrivacyKey}}" page-id="{{.Page.PageId}}" ng-app="zanaduu" ng-controller="ZanaduuCtrl">

{{template "navbar" .User}}

<!-- Modal for new links used from Markdown.Editor. -->
<div class="modal fade" id="new-link-modal" tabindex="-1" style="z-index:2000">
	<div class="modal-dialog">
		<form class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title"></h4>
			</div>
			<div class="modal-body">
				<input name="link" type="text" class="form-control new-link-input">
			</div>
			<div class="modal-footer">
			  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				<button type="submit" class="btn btn-primary">Insert</button>
			</div>
		</div>
	</div>
</div>

<!-- This modal is for creating new pages quickly. -->
<znd-edit-page-modal parent-page-id="'{{.Page.PageId}}'"></znd-edit-page-modal>

{{with .Page}}
	{{if gt .DeletedBy 0}}
		<div class="new-page-body-div">
			<p class="text-center alert alert-danger">This page has been deleted.
				{{if IsAdmin}}
					<span class="admin">By id: {{.DeletedBy}}. <a href="#" class="undo-page-delete">Undo.</a></span>
				{{end}}
			</p>
		</div>
	{{else}}
		<div class="new-page-body-div" ng-controller="MainCtrl">
			<znd-edit-page page-id="page.PageId"></znd-edit-page>
		</div>
	{{end}}
{{end}}

{{template "footer"}}
</body>
</html>
{{end}}
