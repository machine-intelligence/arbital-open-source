{{/* editPage.tmpl is the page for creating a new page or editing an existing one. */}}
{{define "base"}}
<!DOCTYPE html>
<html>
<head>
	<title>{{if .Page.Title}}Edit - {{.Page.Title}}{{else}}New Page{{end}} - Zanaduu</title>
	{{template "style"}}
	{{template "scripts"}}
	{{template "angular" .}}
	<script src="/static/js/editPage.js"></script>
	<script>
		// MainCtrl is the main control for this page.
		app.controller("MainCtrl", function ($scope, pageService, userService) {
			$scope.pageId = "{{.Page.PageId}}";
			$scope.page = pageService.pageMap[$scope.pageId];

			// Called when the user is done editing the page.
			$scope.doneFn = function(result) {
				window.location.replace($scope.page.url);
			};
		});
	</script>
</head>

<body privacy-key="{{.Page.PrivacyKey}}" ng-app="zanaduu" ng-controller="ZanaduuCtrl">
{{template "navbar" .User}}
{{template "newLinkModal"}}

<!-- This modal is for creating new pages quickly. -->
<znd-edit-page-modal parent-page-id="{{.Page.PageId}}"></znd-edit-page-modal>

{{with .Page}}
	{{if gt .DeletedBy 0}}
		<div class="new-page-body-div">
			<p class="text-center alert alert-danger">This page has been deleted.
				{{if IsAdmin}}
					<span class="admin">By id: {{.DeletedBy}}. <a href="#" class="undo-page-delete">Undo.</a></span>
				{{end}}
			</p>
		</div>
	{{else}}
		<div class="new-page-body-div" ng-controller="MainCtrl">
			<znd-edit-page page-id="{[{page.pageId}]}" done-fn="doneFn(result)"></znd-edit-page>
		</div>
	{{end}}
{{end}}

{{template "footer"}}
</body>
</html>
{{end}}
